{% extends "academicPhylo_base.html" %}
{% load staticfiles %}
{% block nav-people %}<li class="current_page_item">{% endblock %}

{% block javascript_doc_ready %}
    <script>
    $( document ).ready(function() {

    //repopulate the values filterSelectWidgets from the hiddenFilterValues by matching up their names
    // which get passed back from the view after each time the view is run
    // this way we don't lose the search parameters each time
    $(".hiddenFilterValues").each(function(){
        var theValue = $(this).val();
        $("#" + this.name).val(theValue);
        $("#" + this.name).css("background-color","rgba(228, 26, 28,.2)");
    });

    //loop through all the filterSelectWidgets and put an onchange event that creates the new url and redirects
    $(".filterSelectWidget").each(function(){
        $(this).on("change",makeURLandRedirect)
    });

    $("#clearSearchFilters").on("click",function(){
        $(".filterSelectWidget").each(function(){
            $(this).val(null);
        });
        window.location.href="/people/";
    });
    function makeURLandRedirect(index){
        var theURL = "/people/?"
        $(".filterSelectWidget").each(function(){
            if($(this).val() !== null){
                partialURL = $(this).attr("id") + "=" + $(this).val() + "&";
                theURL += partialURL;
            };


        });
        window.location.href=theURL;
    };


    });
    </script>
{% endblock %}

{% block base_content %}


    <div id="main-wrapper">
		<div class="5grid-layout">

            <div class="row">
                <h2 class="customMessage" style="background-color:#f1f1f1;padding: 15px;">
                        Find People by Attributes
                <h2>
            </div>
			<div class="row">
				<div class="4u">

					<!-- Sidebar -->
						<div id="sidebar">
						<p>Filter By School
                            {% comment %}
                            Note!! The id of the select widget must be a valid keyword query filter for the connection table
                            Also Note!!! The class must be "filterSelectWidget" for the jquery to work properly
                            Default option value must be set to "disabled"
                            {% endcomment %}
                            <select id="student__school__id__exact" class="filterSelectWidget">
                                <option value="0" selected="selected" disabled="disabled">Choose A School</option>
                                {% for school in schools %}
                                 <option value={{ school.id }}>{{ school.name }}</option>
                                {% endfor %}
                            </select>
                        </p>

                        <p>Filter By Specialization
                            {% comment %}
                            Note!! The id of the select widget must be a valid keyword query filter for the connection table
                            Also Note!!! The class must be "filterSelectWidget" for the jquery to work properly
                            Default option value must be set to "disabled"
                            {% endcomment %}
                            <select id="student__specialization__id__exact" class="filterSelectWidget">
                                <option value="0" selected="selected" disabled="disabled">Choose A Specialization</option>
                                {% for specialization in specializations %}
                                 <option value={{ specialization.id }}>{{ specialization.name }}</option>
                                {% endfor %}
                            </select>
                        </p>

                        <p>Filter By Year of PhD
                            {% comment %}
                            Note!! The id of the select widget must be a valid keyword query filter for the connection table
                            Also Note!!! The class must be "filterSelectWidget" for the jquery to work properly
                            Default option value must be set to "disabled"
                            {% endcomment %}
                            <select id="student__yearOfPhD__exact" class="filterSelectWidget">
                                <option value="0" selected="selected" disabled="disabled">Choose A Year</option>
                                {% for year in years %}
                                 <option value={{ year }}>{{ year }}</option>
                                {% endfor %}
                            </select>
                        </p>

                        {% comment %}
                        <p>Date Range

                            Note!! The id of the select widget must be a valid keyword query filter for the connection table
                            Also Note!!! The class must be "filterSelectWidget" for the jquery to work properly
                            Default option value must be set to "disabled"

                            <select id="student__yearOfPhD__gte" class="filterSelectWidget">
                                <option value="0" selected="selected" disabled="disabled">Choose a Minimum Year</option>
                                {% for year in years %}
                                 <option value={{ year }}>{{ year }}</option>
                                {% endfor %}
                            </select>
                            <select id="student__yearOfPhD__lte" class="filterSelectWidget">
                                <option value="0" selected="selected" disabled="disabled">Choose a Maximum Year</option>
                                {% for year in years %}
                                 <option value={{ year }}>{{ year }}</option>
                                {% endfor %}
                            </select>
                        </p>
                        {% endcomment %}



                        <input type="button" class="customsubmit" style="color:white; background-color: #0090c5; display:inline;" id="clearSearchFilters" value="Clear The Search" />
                        <input type="button" onclick="window.location.href='/search/'" class="customsubmit" value="Search By Name" />
						</div>
                </div>

				<div class="8u">
                    {% if not SearchParameters %}
                        <p class="customMessage">Please select some search options from the menus on the left.</p>
                    {% else %}

                    {% if theConnections.count = 0 %}
                    <p class="customMessage">Nobody in our database matches your query.</p>
                    {% else %}
                     <h3>Showing {{ theConnections.count }} match{% if theConnections.count > 1 %}es{% endif %} for your query.</h3>

                     <table>
                        <tr style="font-weight: bold;"><td>Student Name</td><td>School</td><td>Year</td></tr>
                        {% for each in theConnections %}
                            <tr>
                                <td>{{ each.student.firstName }} {{ each.student.lastName }}</td>
                                <td>{{ each.student.school }}</td>
                                <td>{% if each.student.yearOfPhD == None %}Unknown{% else %}{{ each.student.yearOfPhD }}{% endif %}</td>
                                <td><a href="/detail/{{ each.student.URL_for_detail }}">Details</a></td>
                                <td><a href="/tree/{{ each.student.id }}">Tree</a></td>
                            </tr>
                        {% endfor %}
                    </table>


                {% if filterArgs %}
                    {% for key,value in filterArgs.iteritems %}
                        <input type="hidden" class="hiddenFilterValues" value={{ value }} name="{{ key }}">
                    {% endfor %}

                {% endif %}

                {% endif %}
                {% endif %}
                Please <a href="/contact/">contact us</a> before using data from the site in any publication.
				</div>
			</div>
	</div>
</div>
{% endblock %}